# خطة تنفيذ النسخة المتكاملة للهواتف والأجهزة اللوحية

## نظرة عامة

**الهدف:** تجربة استخدام احترافية 100% على الهواتف الذكية والأجهزة اللوحية دون أي تأثير على نسخة سطح المكتب.

**المبدأ:** الحفاظ على تصميم وسلوك نسخة الحاسبة بالكامل؛ إضافة/تعديل فقط عبر Media Queries و Layout متجاوب.

---

## 1. الحالة الحالية (مراجعة سريعة)

| العنصر | الحالة | ملاحظات |
|--------|--------|---------|
| **القائمة الجانبية** | ✅ Drawer جاهز | `Sidebar` مع `mobile={true}` و overlay؛ `SidebarTrigger` في الهيدر لـ `lg:hidden` |
| **الهيدر** | ✅ متجاوب جزئياً | `px-4 sm:px-6`؛ زر القائمة للجوال |
| **المحتوى الرئيسي** | ✅ هوامش متدرجة | `p-4 sm:p-6 md:p-8` |
| **الجداول** | ⚠️ تحتاج تحسين | `overflow-x-auto` موجود؛ قد يسبب scroll أفقي على شاشات ضيقة |
| **Modals** | ⚠️ تحتاج تحسين | `max-w-lg`؛ تحتاج عرض كامل/شبه كامل على الجوال وزر إغلاق أكبر |
| **الأزرار/اللمس** | ⚠️ مراجعة | بعض الأزرار قد تكون أصغر من 44px |
| **صفحة تسجيل الدخول** | ⚠️ مراجعة | تخطيط وشريط المزايا على الجوال |
| **التقارير والجداول الكبيرة** | ❌ تحتاج Card View | صفحات الموظفين، الإجازات، الغيابات، المستخدمين، الاستيراد، التقارير الرسمية |

---

## 2. Breakpoints المقترحة

توحيد استخدام Tailwind (بدون تغيير سلوك الديسكتوب):

| الاسم | القيمة | الاستخدام |
|-------|--------|-----------|
| **xs** | 375px | (اختياري) هواتف صغيرة جداً |
| **sm** | 640px | هواتف أفقية / هوامش وتكثيف |
| **md** | 768px | أجهزة لوحية صغيرة / إظهار/إخفاء أعمدة |
| **lg** | 1024px | حد القائمة الجانبية vs Drawer (معيار الحالي) |
| **xl** | 1280px | ديسكتوب |
| **2xl** | 1536px | شاشات كبيرة |

**قاعدة التبديل الرئيسية للقوائم والجداول:**
- **&lt; md (768px):** Card View للقوائم الطويلة، Modals full-screen أو near full-screen.
- **md وأعلى:** نفس السلوك الحالي (جداول، Modals بعرض متوسط).

لا يتم إضافة `xs` في Tailwind إلا إذا لزم؛ الاعتماد على `sm` كأصغر breakpoint فعلي.

---

## 3. نمط التنقل (Navigation Pattern) للهاتف

- **القائمة:** تبقى Drawer من اليمين (RTL)، تفتح بزر الهامبرغر في الهيدر، تغلق بالنقر خارجها أو على الرابط.
- **الهيدر:** ثابت (sticky)، يحتوي: زر القائمة، الشعار (مختصر إن لزم)، الإشعارات، اسم المستخدم (أو أيقونة)، زر الخروج. تقليل النص على الشاشات الصغيرة.
- **Breadcrumb:** إظهار على الجوال بشكل مختصر (مثلاً آخر مستوى فقط) أو طي في قائمة إذا زاد العرض.
- **لا تبويب سفلي (Bottom Nav):** الاعتماد على Drawer لتفادي ازدواجية التنقل مع الديسكتوب.

---

## 4. التعديلات المطلوبة حسب الصفحة

### 4.1 المكونات المشتركة (أولوية عالية)

| المكون | التعديل | التفاصيل |
|--------|---------|----------|
| **Table (ui/table)** | عدم تغيير الديسكتوب | إبقاء الـ Table كما هو؛ الصفحات التي تستخدمه تُضيف بديل Card View تحت `md`. |
| **DataTable / CardView** | مكون جديد أو HOC | مكون يعرض نفس البيانات: `Table` من `md` فما فوق، و`Card` list تحت `md`. يُستخدم في: الموظفين، المستخدمين، الاستيراد، الإجازات، الغيابات، الأقسام (إن كان جدولاً). |
| **Modal (ui/modal)** | تحسين الجوال | تحت `md`: عرض كامل أو `max-w-[100vw]` مع هوامش صغيرة، ارتفاع أقصى آمن، زر إغلاق بحد أدنى 44px، منع scroll خلف الـ modal. |
| **Button (ui/button)** | حد لمس | التأكد أن `size="sm"` لا يُستخدم لعناصر أساسية على الجوال؛ استخدام `min-h-touch` (44px) للأزرار الرئيسية في الشريط السفلي أو الهيدر. |
| **ConfirmDialog** | نفس Modal | يورث تحسينات الـ Modal (عرض، زر إغلاق، منع scroll). |
| **Breadcrumb** | اختصار على الجوال | تحت `sm`: إظهار المسار المختصر أو آخر عنصر فقط. |

### 4.2 لوحة التحكم (`/dashboard`)

| البند | التعديل |
|-------|---------|
| شبكة البطاقات | استخدام Grid متجاوب: `grid-cols-1 sm:grid-cols-2 lg:grid-cols-4` (أو كما هو حالي مع التأكد من عدم كسر على 320px). |
| الرسوم البيانية | `ResponsiveContainer` مع `min-height` مناسب على الجوال (مثلاً 220px) وتقليل padding. |
| الروابط | التأكد أن مناطق اللمس للبطاقات لا تقل عن 44px ارتفاعاً. |

### 4.3 تسجيل الدخول (`/login`)

| البند | التعديل |
|-------|---------|
| التخطيط | على الجوال: نموذج فوق، قائمة المزايا أسفل أو قابلة للطي (accordion) أو إخفاؤها تحت `sm`. |
| الحقول والأزرار | عرض كامل، ارتفاع حقل/زر لا يقل عن 44px. |
| الشعار والعنوان | تقليل حجم الخط على الشاشات الصغيرة مع الحفاظ على الوضوح. |

### 4.4 الموظفين (`/dashboard/employees`)

| البند | التعديل |
|-------|---------|
| الفلاتر والبحث | تحت `md`: طي الفلاتر في لوحة قابلة للفتح (accordion أو زر "فلاتر") لتوفير المساحة. |
| الجدول | من `md` فما فوق: الجدول الحالي. تحت `md`: Card View (بطاقة لكل موظف تحتوي: الاسم، المسمى، القسم، الحالة، أزرار تحرير/عرض). |
| Pagination | أزرار أكبر على الجوال أو استبدال جزئي بـ "تحميل المزيد". |
| نوافذ الإضافة/التعديل/الاستيراد | تطبيق تحسينات الـ Modal (عرض كامل أو شبه كامل، أزرار واضحة). |

### 4.5 إكمال البيانات (`/dashboard/data-completion`)

| البند | التعديل |
|-------|---------|
| القائمة/الجداول | إذا وُجد جدول: نفس منطق Card View تحت `md`. |
| الأزرار والإجراءات | حد لمس 44px. |

### 4.6 الاستيراد (`/dashboard/imports`)

| البند | التعديل |
|-------|---------|
| الجدول | تحت `md`: Card لكل دفعة (اسم الملف، التاريخ، العدد، أزرار). |
| رفع الملف | منطقة سحب وإفلات وأزرار بارتفاع لمس مناسب. |

### 4.7 الأقسام (`/dashboard/departments`)

| البند | التعديل |
|-------|---------|
| العرض | إذا كان الجدول كثيف الأعمدة: Card View تحت `md`. |
| النماذج | Modals محسّنة للجوال. |

### 4.8 أجهزة البصمة (`/dashboard/devices`, `/dashboard/devices/[id]`)

| البند | التعديل |
|-------|---------|
| القوائم | Card View تحت `md` إن وُجد جدول. |
| التفاصيل | تخطيط عمودي على الجوال، أزرار إجراءات واضحة. |

### 4.9 تقويم وحدة البصمة (`/dashboard/fingerprint-calendar`)

| البند | التعديل |
|-------|---------|
| التقويم/الشبكة | تقويم متجاوب (أسماء الأيام مختصرة إن لزم، خلايا أكبر للمس). |
| الفلاتر | طي تحت `md` أو شريط قابل للتمرير. |

### 4.10 الإجازات (`/dashboard/leaves`, التقويم، التقرير الرسمي)

| البند | التعديل |
|-------|---------|
| قائمة الطلبات | جدول من `md`، Card View تحت `md`. |
| تقويم الإجازات | عرض متجاوب، لا scroll أفقي. |
| التقرير الرسمي | على الجوال: إما بطاقات ملخصة أو جدول قابل للتمرير العمودي فقط (منع الأفقي). |

### 4.11 أنواع الإجازات (`/dashboard/leave-types`)

| البند | التعديل |
|-------|---------|
| الجدول/القائمة | Card View تحت `md`. |

### 4.12 الغيابات (`/dashboard/absences`, يومي، التقرير الرسمي)

| البند | التعديل |
|-------|---------|
| الجداول | Card View تحت `md`؛ منع أي scroll أفقي. |
| الفلاتر والتواريخ | أزرار وانتقاء تاريخ بمساحة لمس كافية. |

### 4.13 العطل (`/dashboard/holidays`)

| البند | التعديل |
|-------|---------|
| القائمة/الجدول | Card View تحت `md`. |

### 4.14 جداول الدوام (`/dashboard/schedules`, التقرير الرسمي)

| البند | التعديل |
|-------|---------|
| الجداول الكبيرة | على الجوال: إما بطاقات لكل شهر/قسم أو جدول بعرض ثابت مع scroll أفقي مضبوط (شريط واحد واضح) مع تنبيه بصري إن لزم. الأفضل: عرض بطاقات/ملخص ثم تفاصيل في صفحة أو modal. |
| التقرير الرسمي | نفس مبدأ منع scroll الأفقي غير المتوقع. |

### 4.15 التقارير (`/dashboard/reports`)

| البند | التعديل |
|-------|---------|
| بطاقات التقارير | Grid متجاوب، روابط وأزرار بحد لمس 44px. |
| صفحات التقارير الفرعية | تطبيق نفس قواعد الجداول والـ Modals. |

### 4.16 الإعدادات (`/dashboard/settings`)

| البند | التعديل |
|-------|---------|
| النماذج | حقول وأزرار بارتفاع لمس كافٍ، Modals محسّنة. |

### 4.17 إدارة المستخدمين (`/dashboard/users`)

| البند | التعديل |
|-------|---------|
| الجدول | Card View تحت `md` (اسم، صلاحيات مختصرة، أزرار). |
| نوافذ الصلاحيات | Modal كامل الشاشة أو شبه كامل على الجوال. |

### 4.18 سجل التدقيق (`/dashboard/audit-logs`)

| البند | التعديل |
|-------|---------|
| الجدول | Card View تحت `md`؛ تصفية وبحث واضحين. |

### 4.19 تغيير كلمة المرور (`/dashboard/change-password`)

| البند | التعديل |
|-------|---------|
| النموذج | عرض كامل، حقول وأزرار 44px. |

### 4.20 صفحة الموظف (تفاصيل) (`/dashboard/employees/[id]`)

| البند | التعديل |
|-------|---------|
| الأقسام والجداول الداخلية | تخطيط عمودي، جداول صغيرة إما بقاء كما هي أو تحويلها لبطاقات تحت `md`. |

### 4.21 شاشة TV Dashboard (إن وُجدت لاحقاً)

| البند | التعديل |
|-------|---------|
| عرض مصغر | إن أضيفت شاشة مخصصة للعرض على TV، استخدام media query أو route منفصل لتخطيط مصمم للشاشات الكبيرة فقط، دون التأثير على الجوال أو الديسكتوب العادي. |

---

## 5. الأداء على الهاتف

- **تقليل re-renders:** التأكد من أن تحويل الجدول → Card لا يسبب تحميل مزدوج للبيانات؛ استخدام نفس الـ data.
- **Lazy loading للقوائم الطويلة:** اختياري؛ إن وُجدت قوائم بأكثر من 50 عنصراً، اعتبار virtualization أو pagination من جانب العميل بعد الجلب.
- **الصور والأيقونات:** عدم زيادة أحجام غير ضرورية؛ الاعتماد على SVG أو خط الأيقونات الحالي.
- **حجم الحزم:** مراجعة أن أي مكتبة إضافية (مثلاً للتقويم) تكون tree-shaken ولا تزيد bundle الجوال بشكل كبير.

---

## 6. الضمانات المطلوبة

- **الصلاحيات:** لا إخفاء لأي ميزة بسبب الشاشة؛ نفس الصلاحيات على الجوال والحاسبة.
- **عدم كسر الديسكتوب:** كل التعديلات خلف `md` أو `lg` أو داخل مكونات مشتركة لا تغيّر سلوك الديسكتوب.
- **عدم تعارض عناصر:** لا تداخل للنوافذ المنبثقة مع الهيدر أو شريط التنقل.
- **عدم scroll أفقي:** منع أي overflow أفقي غير مقصود في المحتوى الرئيسي (الجداول إما Card أو جدول قابل للتمرير داخل حاوية واحدة واضحة).
- **تناسق الخطوط:** استخدام نفس عائلة الخطوط مع scale مناسب (مثلاً `text-sm` على الجوال للنص الثانوي).
- **استخدام بيد واحدة:** الأزرار الرئيسية والإغلاق في متناول الإبهام على الهاتف (أسفل أو أعلى الشاشة مع حجم كافٍ).

---

## 7. جدول التنفيذ المقترح

| المرحلة | المهام | المدة التقريبية |
|---------|--------|------------------|
| **1. الأساس** | توحيد Breakpoints في tailwind إن لزم، تحسين Modal + ConfirmDialog للجوال، تحسين Button/Breadcrumb لللمس والاختصار | 2–3 أيام |
| **2. مكون القوائم** | إنشاء مكون DataTable/CardView (جدول فوق md، بطاقات تحته) واستخدامه في صفحة واحدة تجريبية (مثلاً الموظفين) | 2–3 أيام |
| **3. الصفحات ذات الجداول** | تطبيق Card View + فلاتر قابلة للطي على: الموظفين، المستخدمين، الاستيراد، الإجازات، الغيابات، الأقسام، أنواع الإجازات، العطل، سجل التدقيق | 3–4 أيام |
| **4. التقارير والجداول الكبيرة** | تقارير رسمية، جداول الدوام، تقويم البصمة، صفحة يوم الغياب؛ منع scroll الأفقي وتجربة بطاقات/تفاصيل | 2–3 أيام |
| **5. تسجيل الدخول واللوحة الرئيسية** | تحسين تخطيط تسجيل الدخول، مراجعة بطاقات لوحة التحكم والرسوم البيانية | 1 يوم |
| **6. الصفحات المتبقية** | الإعدادات، تغيير كلمة المرور، تفاصيل الموظف، أجهزة البصمة وتفاصيلها | 1–2 يوم |
| **7. المراجعة والاختبار** | مراجعة كل صفحة، اختبار الصلاحيات، منع scroll أفقي، تناسق الخطوط والأزرار | 2–3 أيام |

**المجموع التقريبي:** 13–19 يوم عمل.

---

## 8. آلية الاختبار النهائية قبل الاعتماد

### 8.1 أجهزة وأنظمة

- **iPhone:** Safari (آخر إصدارين).
- **Android:** Chrome (آخر إصدارين).
- **iPad:** Safari.
- **Android Tablet:** Chrome.

### 8.2 قائمة التحقق لكل صفحة

لكل صفحة في النظام:

1. **الوظائف:** تنفيذ الإجراءات الرئيسية (إضافة، تعديل، حذف، تصفية، تصدير) حسب الصلاحيات.
2. **التخطيط:** لا قطع نصوص غير مقصود، لا تداخل، لا scroll أفقي (إلا إن كان مقصوداً وواضحاً).
3. **اللمس:** الأزرار والروابط لا تقل عن 44px في المنطقة القابلة للنقر.
4. **Modals:** تفتح وتغلق بشكل صحيح، لا اختفاء زر الإغلاق، إمكانية التمرير للمحتوى الطويل.
5. **الصلاحيات:** نفس القوائم والإجراءات المتاحة على الديسكتوب تظهر على الجوال حسب الصلاحية.

### 8.3 قائمة تحقق عامة

- [ ] تسجيل الدخول يعمل على الهاتف والتابلت.
- [ ] Drawer يفتح ويغلق ويُظهر نفس عناصر القائمة حسب الصلاحيات.
- [ ] لوحة التحكم تعرض البطاقات والرسوم بشكل صحيح.
- [ ] جميع الصفحات التي تحتوي جداول تعرض Card View تحت 768px دون فقدان بيانات أو إجراءات.
- [ ] لا صفحة تسبب scroll أفقي غير مقصود.
- [ ] الإشعارات وزر الخروج واسم المستخدم تعمل في الهيدر على جميع الأحجام.
- [ ] تم اختبار دور مدير النظام ودور محدود الصلاحيات على جهاز واحد على الأقل.

### 8.4 الاعتماد النهائي

- يتم اعتماد النسخة المتجاوبة بعد:
  1. إكمال جميع المهام في جدول التنفيذ.
  2. تنفيذ آلية الاختبار أعلاه على الأجهزة المذكورة.
  3. معالجة جميع العيوب الحرجة (صلاحيات، تعطل إجراءات، scroll أفقي).
  4. موافقة المسؤول عن المشروع على القائمة العامة وقائمة التحقق لكل صفحة.

---

## 9. ملخص الملفات المتوقعة للتعديل/الإضافة

- **مكونات مشتركة:** `ui/modal.tsx`, `ui/button.tsx`, `confirm-dialog.tsx`, `layout/breadcrumb.tsx`؛ مكون جديد مثل `shared/data-table-cards.tsx` أو تكييف صفحات لاستخدام عرض مزدوج (Table + Cards).
- **الصفحات:** جميع الصفحات المذكورة في الفقرة 4 (من لوحة التحكم حتى تفاصيل الموظف وتغيير كلمة المرور).
- **التكوين:** `tailwind.config.ts` (فقط إن أضيفت breakpoints أو tokens لللمس).
- **لا تغيير:** منطق الصلاحيات، الـ API، أو سلوك الديسكتوب الحالي.

---

*آخر تحديث: حسب طلب خطة التنفيذ المتكاملة للجوال والتابلت.*

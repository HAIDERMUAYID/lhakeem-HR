# خطة تطوير شاملة – نظام إدارة الإجازات والدوام | مستشفى الحكيم

## تحليل الوضع الحالي والنقوصات

### 1. الواجهات (UI/UX)

| الجانب | الوضع الحالي | النقص |
|--------|--------------|-------|
| **نظام التصميم** | ألوان أساسية فقط | توكنات غير مكتملة، لا توجد متغيرات CSS متسقة |
| **المكونات** | Button, Input, Card, Modal, Badge | لا يوجد: Table، Select، Toast، Skeleton، Dropdown، Tabs |
| **النماذج** | حقول HTML مباشرة | لا يوجد React Hook Form أو Zod، لا تحقق صريح |
| **الجداول** | عرض يدوي بـ div | لا يوجد TanStack Table، لا ترتيب، لا تكبير أعمدة |
| **حالات التحميل** | spinner فقط | لا Skeletons، تجربة تحميل ضعيفة |
| **الرسائل** | `alert()` للنظام | لا Toast/Notification احترافي |
| **التفاعل** | أساسي | لا تأكيد قبل حذف، لا تأجيل، تغذية راجعة ضعيفة |

### 2. التجربة (UX)

| الجانب | النقص |
|--------|-------|
| **الصفحات الفارغة** | رسائل غير موحدة، لا إرشادات واضحة |
| **الأخطاء** | رسائل غير موحدة، لا Error Boundary |
| **التنقل** | لا Breadcrumb، لا بحث عام |
| **الاستجابة** | Sidebar ثابت على الجوال، لا قائمة همبرغر |
| **الوصولية** | تركيز ضعيف، لا ARIA، أهداف لمس صغيرة أحياناً |

### 3. التقنيات

| المخطط | المطبق |
|--------|--------|
| shadcn/ui + Radix | مكونات يدوية بسيطة |
| React Hook Form + Zod | نماذج عادية بدون مكتبات |
| TanStack Table | عرض يدوي فقط |
| Lazy loading | تحميل كامل للمكونات |

### 4. البنية التحتية

| الجانب | النقص |
|--------|-------|
| **إدارة الحالة** | TanStack Query فقط، لا Zustand/Context للتطبيق |
| **معالجة الأخطاء** | try/catch يدوي فقط |
| **إعادة المحاولة** | لا إعادة محاولة تلقائية للـ API |
| **التخزين المؤقت** | إعدادات React Query افتراضية |

---

## خطة التطوير المرحلية

---

## المرحلة 1: نظام التصميم والمكونات الأساسية (أسبوعان)

### 1.1 نظام التصميم الموحد

- [ ] توحيد CSS Variables في `globals.css`:
  - `--color-primary`, `--color-success`, `--color-warning`, `--color-error`
  - `--spacing-*`, `--radius-*`, `--shadow-*`
  - `--font-size-*`, `--font-weight-*`
- [ ] إضافة سمة Dark (اختياري لاحقاً)
- [ ] توثيق التصميم في ملف `DESIGN_SYSTEM.md`

### 1.2 توسيع مكتبة المكونات

- [x] **Select/Dropdown** – قوائم منسدلة بديلة عن `<select>`
- [x] **Table** – جدول بيانات مع دعم RTL والـ accessibility
- [x] **Toast/Sonner** – إشعارات بديلاً عن `alert()`
- [x] **Skeleton** – حالات تحميل
- [x] **ConfirmDialog** – تأكيد قبل الحذف أو الإجراءات الحرجة
- [ ] **Tabs** – تنسيق المحتوى المتعدد
- [ ] **Tooltip** – توضيحات للمستخدم
- [ ] **DataTable** – جدول متقدم مع ترتيب وتصفية وبحث

### 1.3 تحسين المكونات الحالية

- [ ] **Input** – دعم `error`, `hint`, `disabled`, أيقونات
- [ ] **Button** – حالات `loading`, أيقونة فقط
- [ ] **Card** – `CardHeader`, `CardFooter` منفصلة
- [ ] **Modal** – أحجام مختلفة، إغلاق بالضغط خارج النافذة
- [ ] **Badge** – المزيد من الـ variants للحالات

---

## المرحلة 2: النماذج والتحقق (أسبوع)

### 2.1 إضافة React Hook Form + Zod

- [x] تثبيت `react-hook-form`, `zod`, `@hookform/resolvers`
- [x] إنشاء schemas مشتركة للتحقق
- [ ] مكون `FormField` لربط الحقول
- [x] عرض رسائل الخطأ أسفل كل حقل

### 2.2 تحويل النماذج الرئيسية

- [x] نموذج تسجيل الدخول
- [ ] نموذج إضافة/تعديل موظف
- [ ] نموذج إضافة/تعديل قسم
- [ ] نموذج طلب إجازة
- [ ] نموذج تسجيل غياب
- [ ] نموذج إضافة عطلة
- [ ] نموذج إدارة الصلاحيات

---

## المرحلة 3: تحسين الواجهات والصفحات (أسبوعان)

### 3.1 لوحة التحكم

- [ ] تصميم جديد للإحصائيات
- [ ] بطاقات إحصائيات قابلة للنقر
- [ ] رسوم بيانية أكثر تفصيلاً
- [ ] قائمة إجراءات سريعة
- [ ] تنبيهات لطلبات الإجازات المعلقة

### 3.2 صفحة الموظفين

- [ ] جدول بيانات متقدم
- [ ] ترتيب الأعمدة
- [ ] تصفية حسب القسم ونوع الدوام
- [ ] عرض تفاصيل الموظف في صفحة/جلب جانبي
- [ ] تحميل تدريجي أو infinite scroll
- [ ] Skeleton أثناء التحميل

### 3.3 صفحة الإجازات

- [ ] عرض جدولي أفضل
- [ ] فلترة حسب الحالة والموظف
- [ ] تأكيد قبل الاعتماد/الرفض
- [ ] إمكانية إضافة سبب الرفض
- [ ] ربط أفضل مع التقويم

### 3.4 صفحة الغيابات

- [ ] جدول بيانات
- [ ] فلترة بالتاريخ والموظف
- [ ] تأكيد قبل إلغاء الغياب
- [ ] عرض تداخل مع الإجازات إن وُجد

### 3.5 صفحة التقارير

- [ ] تقارير جاهزة واضحة
- [ ] فلترة بالتاريخ
- [ ] تصدير PDF محسّن
- [ ] رسوم بيانية تفاعلية أكثر

### 3.6 صفحات أخرى

- [x] توحيد حالة الصفحة الفارغة
- [x] توحيد حالات التحميل والخطأ
- [x] Breadcrumb للتنقل
- [ ] عناوين صفحات واضحة وموحدة

---

## المرحلة 4: الاستجابة والجوال (أسبوع)

### 4.1 تحسين الجوال

- [x] Sidebar قابل للطي مع زر همبرغر
- [x] Overlay للقائمة على الشاشات الصغيرة
- [ ] تحسين جداول البيانات للجوال (عرض عمودي أو بطاقات)
- [ ] أهداف لمس لا تقل عن 44px
- [ ] تحسين نماذج الإدخال على الجوال

### 4.2 PWA وOffline

- [ ] Service Worker للعمل دون اتصال جزئي
- [ ] ذاكرة تخزين مؤقت للصفحات الأساسية
- [ ] رسالة واضحة عند انقطاع الإنترنت
- [ ] أيقونات PWA مكتملة

---

## المرحلة 5: التجربة والوصولية (أسبوع)

### 5.1 Toast وإدارة الرسائل

- [x] استبدال كل `alert()` بـ Toast
- [ ] رسائل نجاح/خطأ/تنبيه موحدة
- [ ] إمكانية إعادة المحاولة تلقائياً أو يدوياً

### 5.2 تأكيد الإجراءات

- [x] نافذة تأكيد قبل الحذف
- [x] تأكيد قبل الاعتماد/الرفض
- [x] تأكيد قبل إلغاء الغياب
- [ ] إمكانية إلغاء العمليات الطويلة

### 5.3 الوصولية (a11y)

- [ ] دعم لوحة المفاتيح
- [ ] ARIA للمكونات الديناميكية
- [ ] تباين ألوان كافٍ
- [ ] تركيز واضح عند التنقل
- [ ] تسميات للحقول والنماذج

---

## المرحلة 6: الأداء والموثوقية (أسبوع)

### 6.1 الأداء

- [ ] Lazy loading للصفحات
- [ ] تحسين الصور إذا وُجدت
- [ ] تقليل حجم الـ bundle
- [ ] ضبط React Query: staleTime, cacheTime
- [ ] تحسين استعلامات الـ API (pagination, select)

### 6.2 معالجة الأخطاء

- [x] Error Boundary عام
- [x] صفحة خطأ مخصصة (404, 500)
- [ ] إعادة محاولة تلقائية للـ API الفاشلة
- [ ] تسجيل الأخطاء (console أو خدمة خارجية لاحقاً)

### 6.3 التجربة أثناء التحميل

- [x] Skeleton لكل الصفحات الرئيسية
- [ ] تحميل تدريجي للمحتوى
- [ ] رسالة واضحة أثناء حفظ البيانات

---

## المرحلة 7: تحسينات Backend (اختياري – أسبوع)

### 7.1 API

- [ ] وثائق Swagger/OpenAPI
- [ ] معدل طلبات (Rate limiting)
- [ ] تحسين استعلامات Prisma
- [ ] دعم التصفية والترتيب في الـ endpoints

### 7.2 الأمان

- [ ] تحديث JWT دوري (Refresh Token)
- [ ] إعادة تشفير كلمات المرور
- [ ] تحسين التحقق من الصلاحيات

---

## أولويات التنفيذ الموصى بها

| الأولوية | المهمة | التأثير | الجهد |
|----------|--------|---------|-------|
| 1 | Toast بدلاً من alert | عالي | منخفض |
| 2 | ConfirmDialog للحذف | عالي | منخفض |
| 3 | Skeleton للتحميل | متوسط | منخفض |
| 4 | Select/Dropdown مكون | متوسط | متوسط |
| 5 | تحسين Sidebar للجوال | عالي | متوسط |
| 6 | React Hook Form + Zod | عالي | متوسط |
| 7 | DataTable موحد | عالي | عالي |
| 8 | نظام التصميم (CSS vars) | متوسط | منخفض |

---

## هيكل الملفات المقترح بعد التطوير

```
frontend/src/
├── app/
│   ├── (auth)/
│   ├── (dashboard)/
│   └── error.tsx          # Error Boundary
├── components/
│   ├── ui/                # Button, Input, Card, Modal, Table, Select, Toast...
│   ├── layout/            # Header, Sidebar, Breadcrumb
│   ├── forms/             # FormField, schemas
│   └── shared/            # EmptyState, LoadingSkeleton
├── hooks/
│   ├── use-toast.ts
│   └── use-confirm.ts
├── lib/
│   ├── api.ts
│   ├── schemas.ts         # Zod schemas
│   └── constants.ts
└── styles/
    └── design-tokens.css
```

---

## ملخص

- **المرحلة 1–2:** أساس التصميم والنماذج (حوالي 3 أسابيع)
- **المرحلة 3–4:** تحسين الواجهات والجوال (حوالي 3 أسابيع)
- **المرحلة 5–6:** التجربة والجودة (حوالي أسبوعين)
- **المرحلة 7:** تحسينات Backend (اختياري – أسبوع)

**المدة التقديرية الإجمالية:** 8–10 أسابيع تطوير مستمر.
